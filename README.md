# Индивидуальное ТЗ "Инструмент для отслеживания результатов учебной езды при занятии в автошколе"


## Проблема:
- При занятиях в автошколе учащийся проезжает не все маршруты из возможных.
- Забываются трудные участки маршрутов.
- Ученик не имеет представления о районе на которому он обучается.


## Цель: 
- Создать инструмент с помощью которого ученик мог бы отметить маршруты, по которым он собирается проехать
- Сделать заметки о проблемных для него местах на которых он завалился
- Отметить знаки или сложные участки, что бы примерно иметь представление о местности по которой он передвигается
- Просмотреть карту отъезженных им маршрутов


### Список роутов:
- POST: /register Регистрация
- POST: /auth Авторизация


#### Учебные маршруты
- POST: /routes/ Создать маршрут
- GET: /routes/ Получить список маршрутов
- GET: /routes/points Получить точки сгруппированные по конкретному маршруту
- GET: /routes/{id} Получить маршрут
- PUT: /routes/{id} Изменить маршрут
- DELETE: /routes/{id} Удалить маршрут
- GET: /routes/{id}/points Получить точки для конкретного маршрута


#### Учебные районы
- POST: /areas/ Создать район в рамках которого проходят учебные маршруты
- GET: /areas/ Получить список районов
- GET: /areas/points Получить точки сгруппированные по областям
- GET: /areas/{id} Получить район
- PUT: /areas/{id} Изменить район
- DELETE: /areas/{id} Удалить район
- GET: /areas/{id}/points Получить точки конкретной области


#### Создать заметку
- POST: /marks/ Создать на карте заметку
- POST: /marks?route_id={route_id}&area_id={area_id} Создать на карте заметку (С привязкой к маршруту и/или к области)
- GET: /marks/points Получить точки сгруппированные по заметке
- PUT: /marks/{id} Изменить заметку
- GET: /marks/{id} Изменить заметку
- DELETE: /marks/{id} Удалить заметку
- GET: /marks/{id}/point Получить точку заметки 


### Техническая часть:
- Postgres
- MongoDB (Для хранения маршрутов, пока не знаю какой формат нужен и какие нюансы могут быть, поэтому mongo). <span style="color:red">**Решил заменить MongoDB на Postgres JSONb.**</span>

### Структура БД

![DB Structure](docs/images/db-structure.drawio.png)

## Запуск проекта:
- Клонировать проект:
```
clone git@github.com:jbakhtin/driving-school-route-coverage.git
```
- Перейти в папку migrations и выполнить миграции:
```
export GOOSE_DBSTRING="user=ИМЯ_ПОЛЬЗОВАТЛЯ password=ПАРОЛЬ host=ХОСТ database=ИМЯ_БАЗЫДАНЫХ"
export GOOSE_DRIVER=postgres
goose up
```


## Задачи:
### Инкремент 1
- [x] Описать шаблон README.md 
- [x] Составить список задач на Инкремент 1
- [x] Спроектировать БД
  - [x] Описать связи основных сущностей
  - [x] Описать взаимодействие PostgresSQL и MongoDB (MongoDB заменен на PG JSONb)
- [x] Написать миграции для базы данных
  - [x] Для модели users
- [x] Реализовать заглушки обработчиков
  - [x] Описать интерфейс роутов (Передаваемые параметры) -> Инкремент 2
  - [x] Обработать исключения и возврат кодов ответов
- [x] Запуск сервера
- [x] Тесты
  - [x] Проверка подключения БД
  - [x] Покрыть тестами обработчики основных ресурсов -> Инкремент 2
- [x] Определить параметры окружения и вынести их в конфиги


### Инкремент 2
- [ ] Написать миграции для остальных таблиц
  - [x] routes
  - [ ] areas
  - [ ] marks
- [ ] Написать SQL запросы для сущностей:
  - [x] routes
  - [ ] areas
  - [ ] marks
- [x] Аутентификация пользователя: 
  - [x] Выбор библиотеки или реализовать самостоятельно
  - [x] Хэширование пароля
  - [x] Создание сессии 
  - [x] Проверка сессии
  - [ ] ~~Сброс пароля~~
  - [x] Сохранение в сессии информации о пользователе для дальней идентификации связных с ним сущностей
- [ ] Реализовать логику хендлеров
  - [x] auth
    - [x] Регистрация
    - [x] Авторизация
    - [x] Покрыть тестами
    - [x] Валидация запросов
  - [x] routes
    - [x] Создание
    - [x] Редактирование
    - [x] Отображение
    - [x] Удаление
    - [x] Получить список маршрутов
    - [x] Покрыть тестами
    - [x] Валидация запросов 
  - [ ] areas
  - [ ] marks
- [x] Фоновые процессы
  - [x] Почтовые уведомления
    - [x] Наполнение очереди
    - [x] Отправка уведомлений из очереди
- [x] Завершение работы приложение 
  - [x] Завершение фоновых процессов с помощью паттерна Closer

- [ ] Доработки (после основных работ)
  - [ ] Фоновые процессы
    - [ ] Почтовые уведомления
      - [ ] Сохранение в очереди процессов в хранилище при завершении программы
      - [ ] Поднятие очереди из хранилища в момент страта программы